begin transaction name GSC_shipment_shipment_detail;
TRUNCATE TABLE REPORTING_PROD.GSC.SHIPMENT_DETAIL_DATASET;
INSERT INTO REPORTING_PROD.GSC.SHIPMENT_DETAIL_DATASET
select
    C.LABEL AS CARRIER,
    IB.PARTIAL_TRACKING_NUMBER,
    IB.TRACKING_NUMBER,
    IBI.LPN_CODE,
    I.ITEM_NUMBER AS SKU,
    UPPER(I.GENDER) AS GENDER
from
    LAKE_VIEW.ULTRA_WAREHOUSE.INVOICE_BOX IB
    LEFT JOIN LAKE_VIEW.ULTRA_WAREHOUSE.INVOICE_BOX_ITEM IBI
    ON IB.INVOICE_BOX_ID = IBI.INVOICE_BOX_ID
    LEFT JOIN LAKE_VIEW.ULTRA_WAREHOUSE.LPN L
    ON IBI.LPN_ID = L.LPN_ID
    LEFT JOIN LAKE_VIEW.ULTRA_WAREHOUSE.ITEM I
    ON L.ITEM_ID = I.ITEM_ID
    LEFT JOIN LAKE_VIEW.ULTRA_WAREHOUSE.COMPANY_CARRIER_SERVICE CCS
    ON CCS.COMPANY_CARRIER_SERVICE_ID = IB.COMPANY_CARRIER_SERVICE_ID
    LEFT JOIN LAKE_VIEW.ULTRA_WAREHOUSE.CARRIER_SERVICE
    CS ON CS.CARRIER_SERVICE_ID = CCS.CARRIER_SERVICE_ID
    LEFT JOIN LAKE_VIEW.ULTRA_WAREHOUSE.CARRIER C
    ON C.CARRIER_ID = CS.CARRIER_ID
WHERE
    IB.DATETIME_ADDED >= '2019-01-01'
    and IB.STATUS_CODE_ID = 51
    and (ib.tracking_number is not null or ib.partial_tracking_number is not null)
    and ibi.LPN_ID is not null;
COMMIT;
