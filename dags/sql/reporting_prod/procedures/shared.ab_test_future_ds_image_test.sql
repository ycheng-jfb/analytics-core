INSERT OVERWRITE INTO shared.ab_test_future_ds_image_test
SELECT product_sku,
       master_product_id,
       total_impressions,
       total_sales,
       sort_current,
       sam_id_current,
       aem_uuid_current,
       sort_test,
       sam_id_test,
       aem_uuid_test,
       is_ecat,
       is_plus,
       _is_current,
       _is_deleted,
       product_type,
       current_showroom_date,
       angle1,
       name1,
       gender1,
       "MODEL-GENDER1",
       angle2,
       name2,
       gender2,
       "MODEL-GENDER2",
       "CH_FULL-BODY",
       ch_front,
       ch_back,
       ch_detail,
       ch_crop,
       ch_plus,
       ch_side,
       ch_laydown,
       ch_editorial,
       ch_social,
       "CH_STYLE-TIPS",
       ch_return,
       ch_swatch,
       ch_collage,
       chg_case,
       chg_case_count,
       chgs_count,
       is_video1,
       is_video2,
       sku,
       design_style_number,
       us_product_id,
       ca_product_id,
       current_showroom,
       original_showroom_month,
       go_live_date,
       original_name,
       current_name,
       color,
       color_family,
       item_rank,
       outfit_number_1,
       outfit_number_2,
       outfit_alias_1,
       outfit_alias_2,
       gender,
       category,
       class,
       subclass,
       channel,
       buy_timing,
       item_status,
       style_status,
       sku_status,
       inseams_construction,
       end_use,
       eco_system,
       fit_block,
       color_application,
       fabric,
       fit_style,
       lined_unlined,
       gbb_pricing,
       mainline_capsule,
       switched_to_lead_only,
       switched_back_to_lead_vip,
       size_scale,
       size_range,
       factory,
       lead_time_bucket,
       initial_launch,
       editorial_features,
       additional_launch_other,
       eco_style,
       open_attribute_2,
       open_attribute_3,
       open_attribute_4,
       open_attribute_5,
       shops,
       global_total_units,
       na_total_units,
       us_blended_garment_cost_dollar,
       us_blended_ldp_dollar,
       us_msrp_dollar,
       us_vip_dollar,
       us_blended_vip_imu_percent,
       us_ttl_buy_units,
       us_ttl_blended_garment_cost_dollar,
       us_ttl_blended_ldp_dollar,
       us_ttl_msrp_dollar,
       us_ttl_vip_dollar,
       us_sale_date,
       us_sale_dollar,
       ca_blended_garment_cost_dollar,
       ca_blended_ldp_dollar,
       ca_msrp_dollar,
       ca_vip_dollar,
       ca_blended_vip_imu_percent,
       ca_ttl_buy_units,
       ca_ttl_blended_garment_cost_dollar,
       ca_ttl_blended_ldp_dollar,
       ca_ttl_msrp_dollar,
       ca_ttl_vip_dollar,
       ca_sale_date,
       ca_sale_dollar,
       eu_blended_garment_cost_dollar,
       eu_blended_ldp_dollar,
       eu_msrp_dollar,
       eu_vip_dollar,
       eu_blended_vip_imu_percent,
       eu_ttl_buy_units,
       eu_ttl_blended_garment_cost_dollar,
       eu_ttl_blended_ldp_dollar,
       eu_ttl_msrp_dollar,
       eu_ttl_vip_dollar,
       ret_blended_garment_cost_dollar,
       ret_blended_ldp_dollar,
       ret_msrp_dollar,
       ret_vip_dollar,
       ret_blended_vip_imu_percent,
       ret_ttl_buy_units,
       ret_ttl_blended_garment_cost_dollar,
       ret_ttl_blended_ldp_dollar,
       ret_ttl_msrp_dollar,
       ret_ttl_vip_dollar,
       ret_sale_date,
       ret_sale_dollar,
       category_1_level_1,
       category_2_level_2,
       category_3_level_3,
       category_4_level_4,
       category_5_alt_category,
       category_6_alt_department,
       category_7_us_fit_finds,
       category_8_us_fit_finds,
       category_9_us_fit_finds,
       category_10_us_fit_finds,
       category_11_us_fit_finds,
       category_12_us_fit_finds_price,
       category_13_us_vip_values,
       category_14_ca_fit_finds,
       category_15_ca_fit_finds,
       category_16_ca_fit_finds,
       category_17_ca_fit_finds,
       category_18_ca_fit_finds,
       category_19_ca_fit_finds_price,
       category_20_ca_vip_values,
       category_formula1,
       category_formula2,
       category_formula3,
       other,
       outfits_tab_sr_date,
       sku_count,
       sku_plus_outfits_tab_sr_date,
       sku_plus_sr_date,
       style_plus_color,
       core,
       mila,
       travel,
       wild,
       camo,
       motion365,
       dollar49_shop,
       icon,
       studio,
       train,
       on_the_go,
       colorid,
       rev,
       meta_row_hash,
       meta_create_datetime,
       meta_update_datetime,
       na_blended_ldp,
       eu_plus_uk_total_units,
       eu_plus_uk_blended_ldp,
       uk_blended_garment_cost_dollar,
       uk_blended_ldp_dollar,
       uk_msrp_dollar,
       uk_vip_dollar,
       uk_blended_vip_imu_percent,
       uk_ttl_buy_units,
       uk_ttl_blended_garment_cost_dollar,
       uk_ttl_blended_ldp_dollar,
       uk_ttl_msrp_dollar,
       uk_ttl_vip_dollar,
       sub_brand,
       outfit_number_3,
       outfit_number_4,
       outfit_number_5,
       outfit_number_6,
       outfit_number_7,
       outfit_number_8,
       outfit_number_9,
       outfit_number_10,
       outfit_alias_3,
       outfit_alias_4,
       outfit_alias_5,
       outfit_alias_6,
       outfit_alias_7,
       outfit_alias_8,
       outfit_alias_9,
       outfit_alias_10,
       CONCAT('https://fabletics-us-cdn.justfab.com/media/images/products/' || product_sku || '/' || product_sku ||
              '-' || sort_current || '_271x407.jpg')                          AS current_image_url,
       CONCAT('https://fabletics-us-cdn.justfab.com/media/images/products/' || product_sku || '/' || product_sku ||
              '-' || sort_test || '_271x407.jpg')                             AS test_image_url,
       CASE
           WHEN sub_brand = 'Scrubs' AND ubt.gender ILIKE 'MEN%' THEN 'SC-M-PROD'
           WHEN sub_brand = 'Scrubs' THEN 'SC-W-PROD'
           WHEN sub_brand = 'Fabletics' AND ubt.gender ILIKE 'MEN%' THEN 'FL-M-PROD'
           WHEN sub_brand = 'Fabletics' THEN 'FL-W-PROD'
           WHEN sub_brand = 'Yitty'
               THEN 'YT-PROD' END                                             AS product_sub_brand,
       IFF(ubt.item_status ILIKE '%CORE', 'CORE', 'FASHION') AS lifestyle_type
FROM data_science.image_testing_possible_tests t
         LEFT JOIN (SELECT DISTINCT ubt.*
                    FROM lake.excel.fl_items_ubt ubt
                             JOIN
                         (SELECT sku, MAX(current_showroom) AS max_current_showroom
                          FROM lake.excel.fl_items_ubt
                          GROUP BY 1) AS ms
                         ON ubt.sku = ms.sku
                             AND ubt.current_showroom = ms.max_current_showroom) ubt
                   ON t.product_sku = ubt.sku;