CREATE OR REPLACE VIEW engineering.segment.vw_segmentqa_sxf_us_qa_product_added AS
SELECT DISTINCT
    TO_TIMESTAMP(RECORD_METADATA:CreateTime::string) AS create_time,
    RECORD_METADATA:key::string AS key,
    RECORD_METADATA:offset::NUMBER(38,0) AS offset,
    RECORD_METADATA:partition::NUMBER(38,0) AS partition,
    RECORD_METADATA:topic::string AS topic,
    RECORD_CONTENT:correlationid::string AS correlation_id,
    parse_json(RECORD_CONTENT:data):automated_test::STRING AS automated_test,
    parse_json(RECORD_CONTENT:data):bundle_alias::STRING AS bundle_alias,
    parse_json(RECORD_CONTENT:data):bundle_name::STRING AS bundle_name,
    parse_json(RECORD_CONTENT:data):bundle_product_id::STRING AS bundle_product_id,
    parse_json(RECORD_CONTENT:data):bundle_retail_price::STRING AS bundle_retail_price,
    parse_json(RECORD_CONTENT:data):bundle_sale_price::STRING AS bundle_sale_price,
    parse_json(RECORD_CONTENT:data):bundle_url::STRING AS bundle_url,
    parse_json(RECORD_CONTENT:data):bundle_vip_price::STRING AS bundle_vip_price,
    parse_json(RECORD_CONTENT:data):cart_id::NUMBER(38,0) AS cart_id,
    parse_json(RECORD_CONTENT:data):category::STRING AS category,
    parse_json(RECORD_CONTENT:data):correlation_id::STRING AS data_correlation_id,
    parse_json(RECORD_CONTENT:data):customer_bucket_group::NUMBER(38,0) AS customer_bucket_group,
    parse_json(RECORD_CONTENT:data):customer_gender::STRING AS customer_gender,
    parse_json(RECORD_CONTENT:data):customer_id::NUMBER(38,0) AS customer_id,
    parse_json(RECORD_CONTENT:data):customer_ip::STRING AS customer_ip,
    parse_json(RECORD_CONTENT:data):error::STRING AS error,
    parse_json(RECORD_CONTENT:data):feature::STRING AS feature,
    parse_json(RECORD_CONTENT:data):image_url::STRING AS image_url,
    parse_json(RECORD_CONTENT:data):inventory_availability::NUMBER(38,0) AS inventory_availability,
    parse_json(RECORD_CONTENT:data):inventory_count::NUMBER(38,0) AS inventory_count,
    parse_json(RECORD_CONTENT:data):is_bundle::STRING AS is_bundle,
    parse_json(RECORD_CONTENT:data):list_id::STRING AS list_id,
    parse_json(RECORD_CONTENT:data):loggedin_status::STRING AS loggedin_status,
    parse_json(RECORD_CONTENT:data):membership_status::STRING AS membership_status,
    parse_json(RECORD_CONTENT:data):name::STRING AS name,
    parse_json(RECORD_CONTENT:data):page_hostname::STRING AS page_hostname,
    parse_json(RECORD_CONTENT:data):price::NUMBER(38,2) AS price,
    parse_json(RECORD_CONTENT:data):product_id::STRING AS product_id,
    parse_json(RECORD_CONTENT:data):quantity::NUMBER(38,0) AS quantity,
    parse_json(RECORD_CONTENT:data):retail_price::NUMBER(38,2) AS retail_price,
    parse_json(RECORD_CONTENT:data):sale_price::STRING AS sale_price,
    parse_json(RECORD_CONTENT:data):session_id::NUMBER(38,0) AS session_id,
    parse_json(RECORD_CONTENT:data):sha_email::STRING AS sha_email,
    parse_json(RECORD_CONTENT:data):size::STRING AS size,
    parse_json(RECORD_CONTENT:data):sized_product_id::VARCHAR AS sized_product_id,
    parse_json(RECORD_CONTENT:data):sized_sku::STRING AS sized_sku,
    parse_json(RECORD_CONTENT:data):sku::STRING AS sku,
    parse_json(RECORD_CONTENT:data):store_group_id::NUMBER(38,0) AS store_group_id,
    parse_json(RECORD_CONTENT:data):store_id::NUMBER(38,0) AS store_id,
    parse_json(RECORD_CONTENT:data):url::STRING AS url,
    parse_json(RECORD_CONTENT:data):variant::STRING AS variant,
    parse_json(RECORD_CONTENT:data):vip_price::NUMBER(38,2) AS vip_price,
    parse_json(RECORD_CONTENT:data):visitor_group::STRING AS visitor_group,
    parse_json(RECORD_CONTENT:data):visitor_id::STRING AS visitor_id,
    RECORD_CONTENT:datacontenttype::string AS data_content_type,
    RECORD_CONTENT:date::date AS date,
    RECORD_CONTENT:id::string AS id,
    RECORD_CONTENT:ip::string AS ip,
    RECORD_CONTENT:source::string AS source,
    RECORD_CONTENT:specversion::NUMBER(38,0) AS spec_version,
    RECORD_CONTENT:status::string AS status,
    RECORD_CONTENT:subject::string AS subject,
    RECORD_CONTENT:success::string AS success,
    RECORD_CONTENT:time::timestamp AS time,
    RECORD_CONTENT:type::string AS type
FROM engineering.segment.segmentqa_sxf_us_qa_product_added
  , LATERAL FLATTEN (input => RECORD_METADATA) a
  , LATERAL FLATTEN (input => RECORD_CONTENT) b;
