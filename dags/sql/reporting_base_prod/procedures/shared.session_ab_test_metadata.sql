CREATE OR replace transient TABLE reporting_base_prod.shared.session_ab_test_metadata AS
    SELECT test_framework_id,
       test_label,
       test_framework_description,
       test_framework_ticket,
       campaign_code,
       test_type,
       cms_min_test_start_datetime_hq::timestamp_ntz(9) as cms_min_test_start_datetime_hq,
       CAST(cms_start_date AS VARCHAR) AS cms_start_date,
       CAST(cms_end_date AS VARCHAR) AS cms_end_date,
       store_id,
       store_brand,
       store_region,
       store_country,
       store_name,
       specialty_country_code,
       test_key,
       ab_test_segment,
       test_group,
       ab_test_start_local_datetime,
       ab_test_start_local_date,
       ab_test_start_local_month_date,
       rnk_monthly,
       session_local_datetime,
       session_local_month_date,
       visitor_id,
       session_id,
       customer_id,
       membership_id,
       session_start_membership_state,
       test_start_membership_state,
       test_start_lead_daily_tenure,
       test_start_lead_tenure_group,
       test_start_vip_month_tenure,
       test_start_vip_month_tenure_group,
       membership_price,
       membership_type,
       cumulative_product_gross_profit_decile,
       cumulative_cash_gross_profit_decile,
       platform,
       platform_raw,
       os,
       os_raw,
       browser,
       is_quiz_start_action,
       is_quiz_complete_action,
       is_skip_quiz_action,
       is_lead_registration_action,
       is_quiz_registration_action,
       is_speedy_registration_action,
       is_skip_quiz_registration_action,
       lead_reg_type,
       registration_local_datetime,
       is_yitty_gateway,
       is_male_gateway,
       is_male_session_action,
       is_male_session,
       is_male_customer,
       is_male_session_customer,
       is_pdp_visit,
       is_atb_action,
       is_skip_month_action,
       is_login_action,
       is_cart_checkout_visit,
       channel,
       subchannel,
       gateway_type,
       gateway_sub_type,
       dm_gateway_id,
       gateway_code,
       gateway_name,
       dm_site_id,
       customer_state,
       hdyh,
       is_cms_specific_gender,
       is_valid_gender_sessions,
       is_bot,
       is_cms_specific_lead_day,
       CAST(flag_is_cms_filtered_lead AS VARCHAR) AS flag_is_cms_filtered_lead,
       is_migrated_session,
       hq_max_datetime
FROM   reporting_base_prod.shared.session_ab_test_cms_framework
UNION ALL
SELECT test_framework_id,
       test_label,
       test_framework_description,
       test_framework_ticket,
       campaign_code,
       test_type,
       cms_min_test_start_datetime_hq::timestamp_ntz(9) as cms_min_test_start_datetime_hq,
       cms_start_date,
       cms_end_date,
       store_id,
       store_brand,
       store_region,
       store_country,
       store_name,
       specialty_country_code,
       test_key,
       ab_test_segment,
       test_group,
       ab_test_start_local_datetime,
       ab_test_start_local_date,
       ab_test_start_local_month_date,
       rnk_monthly,
       session_local_datetime,
       session_local_month_date,
       visitor_id,
       session_id,
       customer_id,
       membership_id,
       session_start_membership_state,
       test_start_membership_state,
       test_start_lead_daily_tenure,
       test_start_lead_tenure_group,
       test_start_vip_month_tenure,
       test_start_vip_month_tenure_group,
       membership_price,
       membership_type,
       cumulative_product_gross_profit_decile,
       cumulative_cash_gross_profit_decile,
       platform,
       platform_raw,
       os,
       os_raw,
       browser,
       is_quiz_start_action,
       is_quiz_complete_action,
       is_skip_quiz_action,
       is_lead_registration_action,
       is_quiz_registration_action,
       is_speedy_registration_action,
       is_skip_quiz_registration_action,
       lead_reg_type,
       registration_local_datetime,
       is_yitty_gateway,
       is_male_gateway,
       is_male_session_action,
       is_male_session,
       is_male_customer,
       is_male_session_customer,
       is_pdp_visit,
       is_atb_action,
       is_skip_month_action,
       is_login_action,
       is_cart_checkout_visit,
       channel,
       subchannel,
       gateway_type,
       gateway_sub_type,
       dm_gateway_id,
       gateway_code,
       gateway_name,
       dm_site_id,
       customer_state,
       hdyh,
       is_cms_specific_gender,
       is_valid_gender_sessions,
       is_bot,
       is_cms_specific_lead_day,
       flag_is_cms_filtered_lead,
       is_migrated_session,
       hq_max_datetime
FROM   reporting_base_prod.shared.session_ab_test_sorting_hat
UNION ALL
SELECT test_framework_id,
       test_label,
       test_framework_description,
       test_framework_ticket,
       campaign_code,
       test_type,
       cms_min_test_start_datetime_hq::timestamp_ntz(9) as cms_min_test_start_datetime_hq,
       cms_start_date,
       cms_end_date,
       store_id,
       store_brand,
       store_region,
       store_country,
       store_name,
       specialty_country_code,
       test_key,
       ab_test_segment,
       test_group,
       ab_test_start_local_datetime,
       ab_test_start_local_date,
       ab_test_start_local_month_date,
       rnk_monthly,
       session_local_datetime,
       session_local_month_date,
       visitor_id,
       session_id,
       customer_id,
       membership_id,
       session_start_membership_state,
       test_start_membership_state,
       test_start_lead_daily_tenure,
       test_start_lead_tenure_group,
       test_start_vip_month_tenure,
       test_start_vip_month_tenure_group,
       membership_price,
       membership_type,
       cumulative_product_gross_profit_decile,
       cumulative_cash_gross_profit_decile,
       platform,
       platform_raw,
       os,
       os_raw,
       browser,
       is_quiz_start_action,
       is_quiz_complete_action,
       is_skip_quiz_action,
       is_lead_registration_action,
       is_quiz_registration_action,
       is_speedy_registration_action,
       is_skip_quiz_registration_action,
       lead_reg_type,
       registration_local_datetime,
       is_yitty_gateway,
       is_male_gateway,
       is_male_session_action,
       is_male_session,
       is_male_customer,
       is_male_session_customer,
       is_pdp_visit,
       is_atb_action,
       is_skip_month_action,
       is_login_action,
       is_cart_checkout_visit,
       channel,
       subchannel,
       gateway_type,
       gateway_sub_type,
       dm_gateway_id,
       gateway_code,
       gateway_name,
       dm_site_id,
       customer_state,
       hdyh,
       is_cms_specific_gender,
       is_valid_gender_sessions,
       is_bot,
       is_cms_specific_lead_day,
       flag_is_cms_filtered_lead,
       is_migrated_session,
       hq_max_datetime
FROM   reporting_base_prod.shared.session_ab_test_non_framework
UNION ALL
SELECT test_framework_id,
       test_label,
       test_framework_description,
       test_framework_ticket,
       campaign_code,
       test_type,
       cms_min_test_start_datetime_hq::timestamp_ntz(9) as cms_min_test_start_datetime_hq,
       cms_start_date,
       cms_end_date,
       store_id,
       store_brand,
       store_region,
       store_country,
       store_name,
       specialty_country_code,
       test_key,
       CAST(ab_test_segment AS VARCHAR) AS ab_test_segment,
       test_group,
       ab_test_start_local_datetime,
       ab_test_start_local_date,
       ab_test_start_local_month_date,
       rnk_monthly,
       session_local_datetime,
       session_local_month_date,
       visitor_id,
       session_id,
       customer_id,
       membership_id,
       session_start_membership_state,
       test_start_membership_state,
       test_start_lead_daily_tenure,
       test_start_lead_tenure_group,
       test_start_vip_month_tenure,
       test_start_vip_month_tenure_group,
       membership_price,
       membership_type,
       cumulative_product_gross_profit_decile,
       cumulative_cash_gross_profit_decile,
       platform,
       platform_raw,
       os,
       os_raw,
       browser,
       is_quiz_start_action,
       is_quiz_complete_action,
       is_skip_quiz_action,
       is_lead_registration_action,
       is_quiz_registration_action,
       is_speedy_registration_action,
       is_skip_quiz_registration_action,
       lead_reg_type,
       registration_local_datetime,
       is_yitty_gateway,
       is_male_gateway,
       is_male_session_action,
       is_male_session,
       is_male_customer,
       is_male_session_customer,
       is_pdp_visit,
       is_atb_action,
       is_skip_month_action,
       is_login_action,
       is_cart_checkout_visit,
       channel,
       subchannel,
       gateway_type,
       gateway_sub_type,
       dm_gateway_id,
       gateway_code,
       gateway_name,
       dm_site_id,
       customer_state,
       hdyh,
       is_cms_specific_gender,
       is_valid_gender_sessions,
       is_bot,
       is_cms_specific_lead_day,
       flag_is_cms_filtered_lead,
       is_migrated_session,
       hq_max_datetime
FROM  reporting_base_prod.shared.session_ab_test_builder
UNION ALL
SELECT test_framework_id,
       test_label,
       test_framework_description,
       test_framework_ticket,
       campaign_code,
       test_type,
       cms_min_test_start_datetime_hq::timestamp_ntz(9) as cms_min_test_start_datetime_hq,
       cms_start_date,
       cms_end_date,
       store_id,
       store_brand,
       store_region,
       store_country,
       store_name,
       specialty_country_code,
       test_key,
       CAST(ab_test_segment AS VARCHAR) AS ab_test_segment,
       test_group,
       ab_test_start_local_datetime,
       ab_test_start_local_date,
       ab_test_start_local_month_date,
       rnk_monthly,
       session_local_datetime,
       session_local_month_date,
       visitor_id,
       session_id,
       customer_id,
       membership_id,
       session_start_membership_state,
       test_start_membership_state,
       test_start_lead_daily_tenure,
       test_start_lead_tenure_group,
       test_start_vip_month_tenure,
       test_start_vip_month_tenure_group,
       membership_price,
       membership_type,
       cumulative_product_gross_profit_decile,
       cumulative_cash_gross_profit_decile,
       platform,
       platform_raw,
       os,
       os_raw,
       browser,
       is_quiz_start_action,
       is_quiz_complete_action,
       is_skip_quiz_action,
       is_lead_registration_action,
       is_quiz_registration_action,
       is_speedy_registration_action,
       is_skip_quiz_registration_action,
       lead_reg_type,
       registration_local_datetime,
       is_yitty_gateway,
       is_male_gateway,
       is_male_session_action,
       is_male_session,
       is_male_customer,
       is_male_session_customer,
       is_pdp_visit,
       is_atb_action,
       is_skip_month_action,
       is_login_action,
       is_cart_checkout_visit,
       channel,
       subchannel,
       gateway_type,
       gateway_sub_type,
       dm_gateway_id,
       gateway_code,
       gateway_name,
       dm_site_id,
       customer_state,
       hdyh,
       is_cms_specific_gender,
       is_valid_gender_sessions,
       is_bot,
       is_cms_specific_lead_day,
       flag_is_cms_filtered_lead,
       is_migrated_session,
       hq_max_datetime
FROM  reporting_base_prod.shared.session_ab_test_launchdarkly;

ALTER TABLE reporting_base_prod.shared.session_ab_test_metadata SET data_retention_time_in_days = 0;
