CREATE OR REPLACE VIEW LAKE_VIEW.PINTEREST.SPEND_AD7 AS
select ADVERTISER_ID,
    AH.NAME||'_'||AH.country ADVERTISER_NAME,
    CLICKTHROUGH_1,
    CLICKTHROUGH_2,
    DATE::date date,
    IMPRESSION_1,
    IMPRESSION_2,
    CLOSEUP_1,
    CLOSEUP_2,
    ONSITE_CHECKOUTS_CPA_BILLABLE,
    AD_GROUP_ID PIN_PROMOTION_AD_GROUP_ID,
    AD_GROUP_NAME PIN_PROMOTION_AD_GROUP_NAME,
    AD_GROUP_STATUS PIN_PROMOTION_AD_GROUP_STATUS,
    CAMPAIGN_ID PIN_PROMOTION_CAMPAIGN_ID,
    CAMPAIGN_NAME PIN_PROMOTION_CAMPAIGN_NAME,
    CAMPAIGN_STATUS PIN_PROMOTION_CAMPAIGN_STATUS,
    PIN_PROMOTION_ID,
    PIN_PROMOTION_NAME,
    PIN_PROMOTION_STATUS,
    SPEND_IN_MICRO_DOLLAR,
    TOTAL_CLICK_CHECKOUT,
    TOTAL_CLICK_LEAD,
    TOTAL_CLICK_SIGNUP,
    TOTAL_CONVERSIONS_QUANTITY,
    TOTAL_ENGAGEMENT_CHECKOUT,
    TOTAL_ENGAGEMENT_LEAD,
    TOTAL_ENGAGEMENT_SIGNUP,
    TOTAL_VIEW_CHECKOUT,
    TOTAL_VIEW_LEAD,
    TOTAL_VIEW_SIGNUP,
    ONSITE_CHECKOUTS_VALUE,
    TOTAL_VIEW_ADD_TO_CART,
    TOTAL_CLICK_ADD_TO_CART,
    TOTAL_ENGAGEMENT_ADD_TO_CART,
    convert_timezone('America/Los_Angeles',P._FIVETRAN_SYNCED) AS META_CREATE_DATETIME,
    convert_timezone('America/Los_Angeles',P._FIVETRAN_SYNCED) as META_UPDATE_DATETIME
from LAKE_FIVETRAN.MED_PINTEREST_AD7_V1.PIN_PROMOTION_REPORT  P
LEFT JOIN (select  id, name, country from LAKE_FIVETRAN.MED_PINTEREST_AD7_V1.ADVERTISER_HISTORY
qualify row_number() over (partition by id order by updated_time desc ) = 1) AH on P.ADVERTISER_ID=AH.id

union all

select ADVERTISER_ID,
    AH.NAME||'_'||AH.country,
    CLICKTHROUGH_1,
    CLICKTHROUGH_2,
    DATE::date,
    IMPRESSION_1,
    IMPRESSION_2,
    CLOSEUP_1,
    CLOSEUP_2,
    ONSITE_CHECKOUTS_CPA_BILLABLE,
    AD_GROUP_ID,
    AD_GROUP_NAME,
    AD_GROUP_STATUS,
    CAMPAIGN_ID,
    CAMPAIGN_NAME,
    CAMPAIGN_STATUS,
    PRODUCT_GROUP_ID,
    PRODUCT_GROUP_NAME,
    PRODUCT_GROUP_STATUS,
    SPEND_IN_MICRO_DOLLAR,
    TOTAL_CLICK_CHECKOUT,
    TOTAL_CLICK_LEAD,
    TOTAL_CLICK_SIGNUP,
    TOTAL_CONVERSIONS_QUANTITY,
    TOTAL_ENGAGEMENT_CHECKOUT,
    TOTAL_ENGAGEMENT_LEAD,
    TOTAL_ENGAGEMENT_SIGNUP,
    TOTAL_VIEW_CHECKOUT,
    TOTAL_VIEW_LEAD,
    TOTAL_VIEW_SIGNUP,
    ONSITE_CHECKOUTS_VALUE,
    TOTAL_VIEW_ADD_TO_CART,
    TOTAL_CLICK_ADD_TO_CART,
    TOTAL_ENGAGEMENT_ADD_TO_CART,
    convert_timezone('America/Los_Angeles',P._FIVETRAN_SYNCED) AS META_CREATE_DATETIME,
    convert_timezone('America/Los_Angeles',P._FIVETRAN_SYNCED) as META_UPDATE_DATETIME
from LAKE_FIVETRAN.MED_PINTEREST_AD7_V1.PRODUCT_GROUP_REPORT P
LEFT JOIN (select  id, name, country from LAKE_FIVETRAN.MED_PINTEREST_AD7_V1.ADVERTISER_HISTORY
qualify row_number() over (partition by id order by updated_time desc ) = 1) AH on P.ADVERTISER_ID=AH.id;
